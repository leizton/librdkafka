# example
## producer
producer RdKafka:Producer* = RdKafka:Producer:create(conf, errstr)
if (not producer) exit(1)
headers RdKafka:Headers* = RdKafka:Headers:create()
headers.add("header_key", "header_value")
producer->produce(topic, partition,
                  RdKafka:Producer:RK_MSG_COPY,               ; copy payload
                  const_cast<char*>(msg.c_str()), msg.size()    ; value
                  nullptr, 0                                    ; key
                  0,                                            ; timestamp, default=now()
                  headers,
                  nullptr)                                      ; msg_opaque
## consumer
consumer RdKafka:Consumer* = RdKafka:Consumer:create(conf, errstr)
if (not consumer) exit(1)
topic = RdKafka:Topic:create(consumer, topic_str, tconf, errstr)
consumer->start(topic, partition, RD_KAFKA_OFFSET_END)
- callback
  var cb ConsumeCb*
  while 1
    ; timeout_ms: fetch超时时间
    consumer->consume_callback(topic, partition, timeout_ms, cb, cb_param void*)
- fetch
  while 1
    msg RdKafka:Message* = consumer->consume(topic, partition, timeout_ms)
consumer->stop(topic, partition)


# codefile struct
- src-cpp
  - rdkafkacpp.h  ; 定义各种回调接口
- src
  - rdkafka.h


# global options
## rdkafka.h
- consume offset
RD_KAFKA_OFFSET_BEGINNING   ; beginning of partition queue, oldest msg
RD_KAFKA_OFFSET_END         ; end of partition queue, next msg
RD_KAFKA_OFFSET_STORED      ; retrieved from offset store, rdkafka本地保存的offset


# rdkafkacpp.h
## PartitionerCb
- partitioner_cb(Topic*, key string*, partition_cnt int32, msg_opaque void*):int32 =0
  ; opaque: 直接接触, 但不知其内部成分
## EventCb
- event_cb(ev Event&) =0
- Event
  - Type enum { EVENT_ERROR EVENT_STATS ... }
  - type():Type =0
  - err():ErrorCode =0
## ConsumeCb
- consume_cb(Message&, opaque void*) =0
  ; opaque: consume_callback()传给callback的param
## ErrorCode
  enum { ERR__BEGIN ERR__BAD_MSG ...}
## Conf
- ConfType enum { CONF_GLOBAL CONF_TOPIC }  ; 对所有或单个topic有效
- ex:
  conf->set("metadata.broker.list", brokers, errstr)
  conf->set("event_cb", &my_event_cb, errstr)
  conf->set("partitioner_cb", &my_partitioner_cb, errstr)
- set(key, value, errstr string&):Conf:ConfResult
  ; errset: out_param
## Topic
- create(base Handle*, topic string&, conf Conf*, errstr string&):Topic* static
  topic = new TopicImpl()
  init topic.partitioner_cb_
- name():string =0
- partition_available(partition int32):bool =0
- offset_store(partition int32, offset int64):ErrorCode =0
  ; 记录partition的commited offset
- c_ptr():rd_kafka_topic_s*